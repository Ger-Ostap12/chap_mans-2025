# üì° API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üåê –ë–∞–∑–æ–≤—ã–π URL
```
http://localhost:8000
```

## üîë –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
API –∫–ª—é—á TomTom –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
export TOMTOM_API_KEY="your_api_key_here"
```

## üìã Endpoints

### 1. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ –æ—Ç –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

**POST** `/optimize_routes_from_location`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°—Ç—Ä–æ–∏—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –∫–ª–∏–µ–Ω—Ç–∞–º.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "clients_data": [
    {
      "id": 1,
      "address": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, —É–ª. –ë–æ–ª—å—à–∞—è –°–∞–¥–æ–≤–∞—è, 1",
      "lat": 47.2225,
      "lon": 39.7203,
      "client_level": "VIP",
      "work_start": "09:00",
      "work_end": "18:00",
      "lunch_start": "13:00",
      "lunch_end": "14:00"
    }
  ],
  "num_days": 3
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "num_days": 3,
  "total_clients": 47,
  "user_location": {
    "latitude": 47.2225,
    "longitude": 39.7203,
    "address": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, –†–æ—Å—Å–∏—è",
    "source": "GPS"
  },
  "routes": [
    {
      "day": 1,
      "clients": [
        {
          "id": 0,
          "address": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É",
          "lat": 47.2225,
          "lon": 39.7203,
          "client_level": "–°—Ç–∞–Ω–¥–∞—Ä—Ç",
          "arrival_time": "09:00",
          "service_time": 0,
          "departure_time": "09:00"
        }
      ],
      "total_time": "6 —á–∞—Å–æ–≤ 45 –º–∏–Ω—É—Ç",
      "total_distance": "45.2 –∫–º"
    }
  ]
}
```

### 2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

**POST** `/set_location`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (GPS, IP –∏–ª–∏ –∞–¥—Ä–µ—Å).

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "gps_coords": [47.2225, 39.7203],
  "manual_address": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, –¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å",
  "ip_address": "8.8.8.8"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "location": {
    "latitude": 47.2225,
    "longitude": 39.7203,
    "address": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, –¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å, –†–æ—Å—Å–∏—è",
    "city": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É",
    "country": "–†–æ—Å—Å–∏—è",
    "accuracy": 10.0,
    "source": "GPS"
  },
  "message": "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ: –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, –¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å"
}
```

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è (—Å –∫–∞—Ä—Ç—ã)**

**POST** `/update_location`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±–Ω–æ–≤–ª—è–µ—Ç –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ –º–∞—Ä–∫–µ—Ä–∞ –Ω–∞ –∫–∞—Ä—Ç–µ).

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "latitude": 47.2500,
  "longitude": 39.7500
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "old_location": {
    "latitude": 47.2225,
    "longitude": 39.7203,
    "address": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, –¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å"
  },
  "new_location": {
    "latitude": 47.2500,
    "longitude": 39.7500,
    "address": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, —É–ª. –ü—É—à–∫–∏–Ω—Å–∫–∞—è, –†–æ—Å—Å–∏—è",
    "city": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É",
    "country": "–†–æ—Å—Å–∏—è",
    "accuracy": 10.0,
    "source": "GPS"
  },
  "message": "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ: –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, —É–ª. –ü—É—à–∫–∏–Ω—Å–∫–∞—è"
}
```

### 4. **–ü–µ—Ä–µ—Å—á–µ—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å –Ω–æ–≤–æ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è**

**POST** `/recalculate_routes`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "clients_data": [
    {
      "id": 1,
      "address": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, —É–ª. –ë–æ–ª—å—à–∞—è –°–∞–¥–æ–≤–∞—è, 1",
      "lat": 47.2225,
      "lon": 39.7203,
      "client_level": "VIP"
    }
  ],
  "num_days": 3
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "routes": {
    "success": true,
    "num_days": 3,
    "total_clients": 47,
    "routes": [...]
  },
  "message": "–ú–∞—Ä—à—Ä—É—Ç—ã –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã —Å –Ω–æ–≤–æ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è"
}
```

### 5. **–û—Ç–º–µ—Ç–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∫–∞–∫ –ø–æ—Å–µ—â–µ–Ω–Ω–æ–≥–æ**

**POST** `/mark_visited`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û—Ç–º–µ—á–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∫–∞–∫ –ø–æ—Å–µ—â–µ–Ω–Ω–æ–≥–æ –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –º–∞—Ä—à—Ä—É—Ç—ã.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "client_id": 1,
  "actual_service_time": 25.0
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "visited_client": {
    "id": 1,
    "address": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, —É–ª. –ë–æ–ª—å—à–∞—è –°–∞–¥–æ–≤–∞—è, 1",
    "planned_service_time": 30.0,
    "actual_service_time": 25.0,
    "time_saved": 5.0
  },
  "updated_time": "09:25",
  "remaining_clients": 46,
  "message": "–ö–ª–∏–µ–Ω—Ç 1 –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –ø–æ—Å–µ—â–µ–Ω–Ω—ã–π"
}
```

### 6. **–ü–æ–∏—Å–∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∞–¥—Ä–µ—Å–æ–≤**

**GET** `/location_suggestions?q=–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É&limit=5`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `q` (string) - –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `limit` (int) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "suggestions": [
    {
      "display_name": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, –†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –†–æ—Å—Å–∏—è",
      "latitude": 47.2225,
      "longitude": 39.7203,
      "address": {
        "city": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É",
        "state": "–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
        "country": "–†–æ—Å—Å–∏—è"
      },
      "importance": 0.8
    }
  ],
  "query": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É"
}
```

### 7. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è**

**GET** `/current_location`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "location": {
    "latitude": 47.2225,
    "longitude": 39.7203,
    "address": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É, –¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å, –†–æ—Å—Å–∏—è",
    "city": "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É",
    "country": "–†–æ—Å—Å–∏—è",
    "accuracy": 10.0,
    "source": "GPS"
  }
}
```

### 8. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã**

**GET** `/health`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "tomtom_api_key": "configured",
  "model_loaded": "best_unified_model.pth"
}
```

## üîß –ö–æ–¥—ã –æ—à–∏–±–æ–∫

### **400 Bad Request**
```json
{
  "detail": "–¢—Ä–µ–±—É—é—Ç—Å—è latitude –∏ longitude"
}
```

### **500 Internal Server Error**
```json
{
  "detail": "–û—à–∏–±–∫–∞ TomTom API: Max retries exceeded"
}
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### **1. –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã**

```javascript
// 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
const locationResponse = await fetch('/set_location', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ gps_coords: [47.2225, 39.7203] })
});

// 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
const routesResponse = await fetch('/optimize_routes_from_location', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    clients_data: clients,
    num_days: 3
  })
});

// 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
const updateResponse = await fetch('/update_location', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    latitude: 47.2500,
    longitude: 39.7500
  })
});

// 4. –û—Ç–º–µ—Ç–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∫–∞–∫ –ø–æ—Å–µ—â–µ–Ω–Ω–æ–≥–æ
const visitedResponse = await fetch('/mark_visited', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    client_id: 1,
    actual_service_time: 25.0
  })
});
```

### **2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

```javascript
try {
  const response = await fetch('/optimize_routes_from_location', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ clients_data: clients, num_days: 3 })
  });

  if (!response.ok) {
    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
  }

  const result = await response.json();

  if (result.success) {
    console.log('–ú–∞—Ä—à—Ä—É—Ç—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã:', result.routes);
  } else {
    console.error('–û—à–∏–±–∫–∞:', result.message);
  }
} catch (error) {
  console.error('–û—à–∏–±–∫–∞ API:', error.message);
}
```

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞**: 2-5 —Å–µ–∫—É–Ω–¥ –¥–ª—è 47 –∫–ª–∏–µ–Ω—Ç–æ–≤
- **TomTom API**: 2-3 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å
- **–ü–∞–º—è—Ç—å**: ~500MB
- **CPU**: 1-2 —è–¥—Ä–∞

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
- Rate limiting –¥–ª—è TomTom API
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ API –∫–ª—é—á–µ–π
